<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owner Dashboard</title>
    <link rel="stylesheet" href="Owner.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Dashboard Section Visibility */
        .dashboard-section {
            display: none;
        }
        #menu {
            display: block;
        }

        /* Menu Item Card Styling */
        .menu-item-card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin: 10px;
        }
        .menu-item-actions {
            margin-top: 10px;
        }

        /* Button Styles */
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }

        /* Navigation Active State */
        nav ul li a.active {
            color: #3a86ff;
            font-weight: 600;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.show {
            display: flex;
        }
        .modal-content {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 70vh;
            overflow-y: auto;
            padding: 15px;
        }
        .modal-header {
            margin-bottom: 15px;
        }
        .modal-header h2 {
            margin: 0;
            font-size: 20px;
        }
        .modal-body {
            padding: 0;
        }
        .form-group {
            margin-bottom: 10px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .form-group textarea {
            height: 60px;
            resize: vertical;
        }
        .modal-footer {
            margin-top: 15px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        .btn {
            padding: 6px 12px;
            font-size: 14px;
        }

        /* Sign-Up Link Styling */
        .signup-link {
            text-align: center;
            margin-top: 10px;
        }
        .signup-link a {
            color: #3a86ff;
            text-decoration: none;
        }
        .signup-link a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('loginModal')">×</span>
            <div class="login-container">
                <div class="login-header">
                    <h2>Owner Dashboard</h2>
                    <p>Login to access your restaurant management system</p>
                </div>
                <div class="form">
                    <div class="form-group email-input">
                        <label for="email">Email</label>
                        <input type="email" id="email" placeholder="Enter your email address">
                        <i class="fa fa-envelope"></i>
                    </div>
                    <div class="form-group password-input">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Enter your password">
                        <i class="fa fa-lock"></i>
                        <button type="button" class="toggle-password" onclick="togglePassword('password')">
                            <i class="fa fa-eye"></i>
                        </button>
                    </div>
                    <div class="form-options">
                        <div class="remember-me">
                            <input type="checkbox" id="remember">
                            <label for="remember">Remember me</label>
                        </div>
                        <a href="#" class="forgot-password">Forgot password?</a>
                    </div>
                    <button class="login-btn" onclick="handleLogin()">
                        <span class="btn-text">Log In</span>
                        <span class="btn-loader"><i class="fa fa-spinner fa-spin"></i></span>
                        <span class="btn-icon"><i class="fa fa-arrow-right"></i></span>
                    </button>
                    <div class="security-note">
                        <i class="fa fa-shield"></i>
                        <span>Your login is secure. We use encryption to protect your data.</span>
                    </div>
                    <div class="signup-link">
                        <p>Don't have an account? <a href="#" onclick="showSignUpModal()">Sign Up</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sign-Up Modal -->
    <div class="modal" id="signupModal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('signupModal')">×</span>
            <div class="login-container">
                <div class="login-header">
                    <h2>Sign Up</h2>
                    <p>Create an account to manage your restaurant</p>
                </div>
                <div class="form">
                    <div class="form-group">
                        <label for="signupName">Full Name</label>
                        <input type="text" id="signupName" placeholder="Enter your full name" required>
                        <i class="fa fa-user"></i>
                    </div>
                    <div class="form-group">
                        <label for="signupRestaurant">Restaurant Name</label>
                        <input type="text" id="signupRestaurant" placeholder="Enter your restaurant name" required>
                        <i class="fa fa-store"></i>
                    </div>
                    <div class="form-group email-input">
                        <label for="signupEmail">Email</label>
                        <input type="email" id="signupEmail" placeholder="Enter your email address" required>
                        <i class="fa fa-envelope"></i>
                    </div>
                    <div class="form-group password-input">
                        <label for="signupPassword">Password</label>
                        <input type="password" id="signupPassword" placeholder="Create a password" required>
                        <i class="fa fa-lock"></i>
                        <button type="button" class="toggle-password" onclick="togglePassword('signupPassword')">
                            <i class="fa fa-eye"></i>
                        </button>
                    </div>
                    <button class="login-btn" onclick="handleSignUp()">
                        <span class="btn-text">Sign Up</span>
                        <span class="btn-icon"><i class="fa fa-arrow-right"></i></span>
                    </button>
                    <div class="security-note">
                        <i class="fa fa-shield"></i>
                        <span>Your data is secure. We use encryption to protect your information.</span>
                    </div>
                    <div class="signup-link">
                        <p>Already have an account? <a href="#" onclick="showLoginModal()">Log In</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard (Initially Hidden) -->
    <div id="dashboard" style="display: none;">
        <nav>
            <ul>
                <li><a href="#menu" class="active">Menu</a></li>
                <li><a href="OwnerOrders.html">Orders</a></li>
                <li><a href="OwnerBookings.html">Bookings</a></li>
                <li><a href="OwnerInventory.html">Inventory</a></li>
                <li><a href="OwnerAnalytics.html">Analytics</a></li>
                <li><a href="#" id="logoutBtn">Logout</a></li>
            </ul>
        </nav>

        <div class="dashboard-container">
            <!-- Menu Section -->
            <section id="menu" class="dashboard-section">
                <div class="section-heading">
                    <h2>Menu Management</h2>
                    <button id="addItemBtn" class="btn btn-primary">Add New Item</button>
                </div>
                <div class="search-box">
                    <input type="text" id="menuSearch" placeholder="Search menu items...">
                    <i class="fas fa-search"></i>
                </div>
                <div id="menuItems" class="grid-container">
                    <div class="loading">Loading menu items...</div>
                </div>
            </section>

            <!-- Orders Section -->
            <section id="orders" class="dashboard-section">
                <div class="section-heading">
                    <h2>Orders</h2>
                    <div class="filter-container">
                        <select id="orderStatus" class="filter-select">
                            <option value="all">All Orders</option>
                            <option value="pending">Pending</option>
                            <option value="preparing">Preparing</option>
                            <option value="ready">Ready</option>
                            <option value="delivered">Delivered</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>
                <div class="search-box">
                    <input type="text" id="orderSearch" placeholder="Search orders...">
                    <i class="fas fa-search"></i>
                </div>
                <div class="debug-controls">
                    <button id="createTestOrderBtn" class="btn btn-secondary">Create Test Order</button>
                    <button id="debugOrdersBtn" class="btn btn-secondary">Debug Orders</button>
                    <button id="forceShowOrdersBtn" class="btn btn-secondary">Force Show Orders</button>
                </div>
                <div id="ordersList">
                    <div class="loading">Loading orders...</div>
                </div>
            </section>

            <!-- Inventory Section -->
            <section id="inventory" class="dashboard-section">
                <div class="section-heading">
                    <h2>Inventory Management</h2>
                    <button id="addInventoryBtn" class="btn btn-primary">Add New Item</button>
                </div>
                <div class="search-box">
                    <input type="text" id="inventorySearch" placeholder="Search inventory...">
                    <i class="fas fa-search"></i>
                </div>
                <div id="inventoryList" class="grid-container">
                    <div class="loading">Loading inventory items...</div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics" class="dashboard-section">
                <div class="section-heading">
                    <h2>Analytics</h2>
                </div>
                <div class="grid-container analytics">
                    <div class="analytics-card">
                        <h3>Today's Revenue</h3>
                        <div class="value" id="todayRevenue">0</div>
                        <div class="trend up"><i class="fas fa-arrow-up"></i> 15% vs. yesterday</div>
                    </div>
                    <div class="analytics-card">
                        <h3>Today's Orders</h3>
                        <div class="value" id="todayOrders">0</div>
                        <div class="trend up"><i class="fas fa-arrow-up"></i> 8% vs. yesterday</div>
                    </div>
                    <div class="analytics-card">
                        <h3>Popular Items</h3>
                        <ul id="popularItems" class="stats-list"></ul>
                    </div>
                    <div class="analytics-card">
                        <h3>Low Stock Items</h3>
                        <ul id="lowStockItems" class="stats-list"></ul>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div id="addItemModal" class="modal">
        <div class="modal-content">
            <span class="close">×</span>
            <div class="modal-header">
                <h2>Add New Menu Item</h2>
            </div>
            <div class="modal-body">
                <form id="addItemForm">
                    <div class="form-group">
                        <label for="itemName">Item Name</label>
                        <input type="text" id="itemName" required placeholder="Enter menu item name">
                        <div class="validation-message">Please enter a valid item name</div>
                    </div>
                    <div class="form-group">
                        <label for="itemDescription">Description</label>
                        <textarea id="itemDescription" required placeholder="Enter item description"></textarea>
                        <div class="validation-message">Please enter a description</div>
                    </div>
                    <div class="form-group price-input">
                        <label for="itemPrice">Price</label>
                        <input type="number" id="itemPrice" min="0" step="0.01" required placeholder="0.00">
                        <div class="validation-message">Please enter a valid price</div>
                    </div>
                    <div class="form-group">
                        <label for="itemCategory">Category</label>
                        <select id="itemCategory" required>
                            <option value="" disabled selected>Select a category</option>
                            <option value="starters">Starters</option>
                            <option value="main">Main Course</option>
                            <option value="desserts">Desserts</option>
                            <option value="beverages">Beverages</option>
                        </select>
                        <div class="validation-message">Please select a category</div>
                    </div>
                    <div class="form-group">
                        <label for="itemImage">Image URL</label>
                        <input type="url" id="itemImage" required placeholder="https://example.com/image.jpg">
                        <div class="validation-message">Please enter a valid URL</div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Item</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Inventory Modal -->
    <div id="addInventoryModal" class="modal">
        <div class="modal-content">
            <span class="close">×</span>
            <div class="modal-header">
                <h2>Add New Inventory Item</h2>
            </div>
            <div class="modal-body">
                <form id="addInventoryForm">
                    <div class="form-group">
                        <label for="inventoryName">Item Name</label>
                        <input type="text" id="inventoryName" required>
                    </div>
                    <div class="form-group">
                        <label for="inventoryQuantity">Quantity</label>
                        <input type="number" id="inventoryQuantity" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="inventoryUnit">Unit</label>
                        <input type="text" id="inventoryUnit" required placeholder="e.g., kg, liters, pcs">
                    </div>
                    <div class="form-group">
                        <label for="inventoryThreshold">Low Stock Threshold</label>
                        <input type="number" id="inventoryThreshold" min="0" required>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Item</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAlYso3uIhbyU711F_1Wt9eJzBtcPOUlKY",
            authDomain: "hotel-managment-48744.firebaseapp.com",
            projectId: "hotel-managment-48744",
            storageBucket: "hotel-managment-48744.firebasestorage.app",
            messagingSenderId: "91221905283",
            appId: "1:91221905283:web:cc9a643990db68ebd0b0b6"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        document.addEventListener('DOMContentLoaded', function() {
            const loginModal = document.getElementById('loginModal');
            const signupModal = document.getElementById('signupModal');
            const dashboard = document.getElementById('dashboard');

            auth.onAuthStateChanged(function(user) {
                if (user) {
                    db.collection('users').doc(user.uid).get()
                        .then(doc => {
                            if (doc.exists && doc.data().role === 'owner') {
                                loginModal.classList.remove('show');
                                signupModal.classList.remove('show');
                                loginModal.style.display = "none";
                                signupModal.style.display = "none";
                                dashboard.style.display = 'block';
                                loadDashboardData();
                                if (window.location.hash) {
                                    const sectionId = window.location.hash.substring(1);
                                    if (document.getElementById(sectionId)) {
                                        showSection(sectionId);
                                    }
                                }
                            } else {
                                loginModal.classList.add('show');
                                auth.signOut();
                            }
                        })
                        .catch(error => {
                            console.error("Error checking user role:", error);
                            loginModal.classList.add('show');
                        });
                } else {
                    loginModal.classList.add('show');
                }
            });

            const savedEmail = localStorage.getItem('ownerEmail');
            if (savedEmail) {
                document.getElementById('email').value = savedEmail;
                document.getElementById('remember').checked = true;
            }

            window.login = function(email, password) {
                return new Promise((resolve, reject) => {
                    auth.signInWithEmailAndPassword(email, password)
                        .then(userCredential => {
                            return db.collection('users').doc(userCredential.user.uid).get()
                                .then(doc => {
                                    if (doc.exists && doc.data().role === 'owner') {
                                        loginModal.classList.remove('show');
                                        setTimeout(() => {
                                            loginModal.style.display = "none";
                                            document.getElementById('dashboard').style.display = 'block';
                                        }, 300);
                                        showSuccess('Welcome to the Owner Dashboard');
                                        loadDashboardData();
                                        resolve();
                                    } else {
                                        auth.signOut();
                                        reject(new Error('Access denied. Owner privileges required.'));
                                    }
                                });
                        })
                        .catch(error => {
                            reject(error);
                        });
                });
            };

            document.getElementById('logoutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                auth.signOut()
                    .then(() => {
                        document.getElementById('dashboard').style.display = 'none';
                        loginModal.classList.add('show');
                        showSuccess('Logged out successfully');
                    })
                    .catch(error => {
                        showError('Logout failed: ' + error.message);
                    });
            });

            document.querySelectorAll('.close, .close-modal').forEach(element => {
                element.addEventListener('click', function() {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.classList.remove('show');
                    });
                });
            });

            initializeMenuManagement();
            initializeInventoryManagement();

            document.getElementById('createTestOrderBtn').addEventListener('click', createTestOrder);
            document.getElementById('debugOrdersBtn').addEventListener('click', inspectOrderIDs);
            document.getElementById('forceShowOrdersBtn').addEventListener('click', loadOrders);

            document.getElementById('orderStatus').addEventListener('change', function() {
                filterOrdersByStatus(this.value);
            });
        });

        function loadDashboardData() {
            loadMenu();
            loadOrders();
            loadInventory();
            loadAnalytics();
            showSection('menu');
            setupNavigation();
        }

        function setupNavigation() {
            document.querySelectorAll('nav ul li a').forEach(link => {
                link.addEventListener('click', function(e) {
                    const href = this.getAttribute('href');
                    if (href.startsWith('#')) {
                        e.preventDefault();
                        const sectionId = href.substring(1);
                        showSection(sectionId);
                    } else {
                        e.preventDefault();
                        window.location.href = href;
                    }
                });
            });
        }

        function showSuccess(message) {
            const notification = document.createElement('div');
            notification.className = 'notification success';
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s forwards';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function showError(message) {
            const notification = document.createElement('div');
            notification.className = 'notification error';
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s forwards';
                setTimeout(() => notification.remove(), 4000);
            }, 4000);
        }

        function initializeMenuManagement() {
            document.getElementById('addItemBtn').addEventListener('click', function() {
                document.getElementById('addItemModal').classList.add('show');
                document.getElementById('addItemForm').reset();
                document.getElementById('addItemModal').querySelector('.modal-header h2').textContent = 'Add New Menu Item';
                const form = document.getElementById('addItemForm');
                form.onsubmit = addItemHandler;
            });
        }

        function initializeInventoryManagement() {
            document.getElementById('addInventoryBtn').addEventListener('click', function() {
                document.getElementById('addInventoryModal').classList.add('show');
            });

            document.getElementById('addInventoryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                showSuccess('Inventory item added successfully');
                document.getElementById('addInventoryModal').classList.remove('show');
            });
        }

        function loadMenu() {
            const menuContainer = document.getElementById('menuItems');

            db.collection('menu').get()
                .then(snapshot => {
                    menuContainer.innerHTML = '';
                    if (snapshot.empty) {
                        menuContainer.innerHTML = '<p>No menu items found</p>';
                        return;
                    }

                    snapshot.forEach(doc => {
                        const item = doc.data();
                        const itemElement = createMenuItemElement(doc.id, item);
                        menuContainer.appendChild(itemElement);
                    });

                    document.querySelectorAll('.edit-item').forEach(button => {
                        button.addEventListener('click', handleEditItem);
                    });

                    document.querySelectorAll('.delete-item').forEach(button => {
                        button.addEventListener('click', handleDeleteItem);
                    });
                })
                .catch(error => {
                    console.error('Error loading menu:', error);
                    menuContainer.innerHTML = '<div class="error">Failed to load menu items</div>';
                });
        }

        function createMenuItemElement(id, item) {
            const card = document.createElement('div');
            card.className = 'menu-item-card';
            card.dataset.id = id;

            card.innerHTML = `
                <img src="${item.image || 'https://via.placeholder.com/300x200?text=No+Image'}" alt="${item.name}">
                <div class="menu-item-details">
                    <h3>${item.name}</h3>
                    <p>${item.description || 'No description available'}</p>
                    <div class="menu-item-price">₹${parseFloat(item.price).toFixed(2)}</div>
                    <div class="menu-item-actions">
                        <button class="btn btn-secondary edit-item" data-id="${id}">Edit</button>
                        <button class="btn btn-danger delete-item" data-id="${id}">Delete</button>
                    </div>
                </div>
            `;

            return card;
        }

        function handleEditItem(event) {
            const itemId = event.target.dataset.id;

            db.collection('menu').doc(itemId).get()
                .then(doc => {
                    if (doc.exists) {
                        const item = doc.data();

                        document.getElementById('itemName').value = item.name;
                        document.getElementById('itemDescription').value = item.description;
                        document.getElementById('itemPrice').value = item.price;
                        document.getElementById('itemCategory').value = item.category;
                        document.getElementById('itemImage').value = item.image;

                        const modal = document.getElementById('addItemModal');
                        modal.classList.add('show');
                        modal.querySelector('.modal-header h2').textContent = 'Edit Menu Item';

                        const form = document.getElementById('addItemForm');
                        form.removeEventListener('submit', addItemHandler);

                        form.onsubmit = function(e) {
                            e.preventDefault();
                            const updatedItem = {
                                name: document.getElementById('itemName').value,
                                description: document.getElementById('itemDescription').value,
                                price: parseFloat(document.getElementById('itemPrice').value),
                                category: document.getElementById('itemCategory').value,
                                image: document.getElementById('itemImage').value,
                                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                            };

                            db.collection('menu').doc(itemId).update(updatedItem)
                                .then(() => {
                                    showSuccess('Menu item updated successfully');
                                    modal.classList.remove('show');
                                    loadMenu();
                                })
                                .catch(error => {
                                    showError('Error updating item: ' + error.message);
                                });
                        };
                    }
                })
                .catch(error => {
                    showError('Error loading item data: ' + error.message);
                });
        }

        function handleDeleteItem(event) {
            const itemId = event.target.dataset.id;

            if (confirm('Are you sure you want to delete this menu item?')) {
                db.collection('menu').doc(itemId).delete()
                    .then(() => {
                        showSuccess('Menu item deleted successfully');
                        loadMenu();
                    })
                    .catch(error => {
                        showError('Error deleting item: ' + error.message);
                    });
            }
        }

        const addItemHandler = function(e) {
            e.preventDefault();
            const newItem = {
                name: document.getElementById('itemName').value,
                description: document.getElementById('itemDescription').value,
                price: parseFloat(document.getElementById('itemPrice').value),
                category: document.getElementById('itemCategory').value,
                image: document.getElementById('itemImage').value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            db.collection('menu').add(newItem)
                .then(() => {
                    showSuccess('Menu item added successfully');
                    document.getElementById('addItemModal').classList.remove('show');
                    loadMenu();
                })
                .catch(error => {
                    showError('Error adding menu item: ' + error.message);
                });
        };

        function loadOrders() {
            const ordersContainer = document.getElementById('ordersList');

            db.collection('orders').orderBy('createdAt', 'desc').get()
                .then(snapshot => {
                    ordersContainer.innerHTML = '';
                    if (snapshot.empty) {
                        ordersContainer.innerHTML = '<p>No orders found</p>';
                        return;
                    }

                    snapshot.forEach(doc => {
                        const order = doc.data();
                        const orderElement = createOrderElement(doc.id, order);
                        ordersContainer.appendChild(orderElement);
                    });
                })
                .catch(error => {
                    console.error('Error loading orders:', error);
                    ordersContainer.innerHTML = '<div class="error">Failed to load orders</div>';
                });
        }

        function createOrderElement(id, order) {
            const listItem = document.createElement('div');
            listItem.className = 'list-item';
            listItem.dataset.id = id;

            const totalPrice = order.items.reduce((total, item) => total + (item.price * item.quantity), 0);
            const orderDate = order.createdAt ? new Date(order.createdAt.toDate()).toLocaleString() : 'Unknown date';
            const statusClass = `status-${order.status || 'pending'}`;

            listItem.innerHTML = `
                <div class="list-item-header">
                    <div class="list-item-id">Order #${id.slice(-6)}</div>
                    <div class="list-item-date">${orderDate}</div>
                    <div class="status-pill ${statusClass}">${order.status || 'pending'}</div>
                </div>
                <div class="list-item-content">
                    <div class="customer-info">
                        <p><strong>Customer:</strong> ${order.customerName || 'Anonymous'}</p>
                        <p><strong>Contact:</strong> ${order.customerEmail || 'N/A'}</p>
                    </div>
                    <div class="order-items">
                        <h4>Items:</h4>
                        <ul>
                            ${order.items.map(item => `
                                <li>${item.name} × ${item.quantity} - ${(item.price * item.quantity).toFixed(2)}</li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
                <div class="list-item-footer">
                    <div class="order-total">Total: ${totalPrice.toFixed(2)}</div>
                    <div class="list-item-actions">
                        <button class="btn btn-primary update-status" data-id="${id}" onclick="showUpdateStatusOptions(this)">Update Status</button>
                        <div class="status-options" style="display: none;">
                            <button class="btn btn-secondary status-option" data-status="pending" data-id="${id}">Pending</button>
                            <button class="btn btn-secondary status-option" data-status="preparing" data-id="${id}">Preparing</button>
                            <button class="btn btn-secondary status-option" data-status="ready" data-id="${id}">Ready</button>
                            <button class="btn btn-secondary status-option" data-status="delivered" data-id="${id}">Delivered</button>
                            <button class="btn btn-secondary status-option" data-status="completed" data-id="${id}">Completed</button>
                        </div>
                    </div>
                </div>
            `;

            listItem.querySelectorAll('.status-option').forEach(button => {
                button.addEventListener('click', function() {
                    const orderId = this.dataset.id;
                    const newStatus = this.dataset.status;
                    updateOrderStatus(orderId, newStatus);
                });
            });

            return listItem;
        }

        function showUpdateStatusOptions(button) {
            const statusOptions = button.nextElementSibling;
            if (statusOptions.style.display === 'none') {
                statusOptions.style.display = 'flex';
                button.textContent = 'Cancel';
            } else {
                statusOptions.style.display = 'none';
                button.textContent = 'Update Status';
            }
        }

        function updateOrderStatus(orderId, newStatus) {
            db.collection('orders').doc(orderId).update({
                status: newStatus
            })
            .then(() => {
                showSuccess(`Order status updated to ${newStatus}`);
                const orderElement = document.querySelector(`.list-item[data-id="${orderId}"]`);
                if (orderElement) {
                    const statusPill = orderElement.querySelector('.status-pill');
                    if (statusPill) {
                        statusPill.className = `status-pill status-${newStatus}`;
                        statusPill.textContent = newStatus;
                    }
                    const statusOptions = orderElement.querySelector('.status-options');
                    const updateButton = orderElement.querySelector('.update-status');
                    if (statusOptions && updateButton) {
                        statusOptions.style.display = 'none';
                        updateButton.textContent = 'Update Status';
                    }
                }
                filterOrdersByStatus(document.getElementById('orderStatus').value);
            })
            .catch(error => {
                showError('Error updating order status: ' + error.message);
            });
        }

        function loadInventory() {
            // Implement inventory loading logic here if needed
        }

        function loadAnalytics() {
            // Implement analytics loading logic here if needed
        }

        function createTestOrder() {
            const statuses = ['pending', 'preparing', 'ready', 'delivered', 'completed'];
            const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];

            const testOrder = {
                customerName: 'Test Customer',
                customerEmail: 'test@example.com',
                status: randomStatus,
                items: [
                    { id: 'test1', name: 'Test Item 1', price: 100, quantity: 2, image: 'https://via.placeholder.com/100' },
                    { id: 'test2', name: 'Test Item 2', price: 150, quantity: 1, image: 'https://via.placeholder.com/100' }
                ],
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            db.collection('orders').add(testOrder)
                .then(docRef => {
                    showSuccess('Test order created with ID: ' + docRef.id + ' (Status: ' + randomStatus + ')');
                    loadOrders();
                })
                .catch(error => {
                    showError('Error creating test order: ' + error.message);
                });
        }

        function inspectOrderIDs() {
            db.collection('orders').get()
                .then(snapshot => {
                    const orderIDs = snapshot.docs.map(doc => doc.id);
                    console.log('Order IDs:', orderIDs);
                    alert('Found ' + orderIDs.length + ' orders. See console for details.');
                })
                .catch(error => {
                    console.error('Error getting orders:', error);
                    showError('Error getting orders: ' + error.message);
                });
        }

        function handleLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.querySelector('.login-btn');

            loginBtn.classList.add('loading');
            loginBtn.disabled = true;

            if (!email || !password) {
                showError('Please enter both email and password');
                loginBtn.classList.remove('loading');
                loginBtn.disabled = false;
                return;
            }

            if (document.getElementById('remember').checked) {
                localStorage.setItem('ownerEmail', email);
            } else {
                localStorage.removeItem('ownerEmail');
            }

            login(email, password)
                .then(() => {})
                .catch(error => {
                    showError(error.message);
                    loginBtn.classList.remove('loading');
                    loginBtn.disabled = false;
                });
        }

        function handleSignUp() {
            const name = document.getElementById('signupName').value;
            const restaurant = document.getElementById('signupRestaurant').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const signupBtn = document.querySelector('#signupModal .login-btn');

            signupBtn.classList.add('loading');
            signupBtn.disabled = true;

            if (!name || !restaurant || !email || !password) {
                showError('Please fill in all fields');
                signupBtn.classList.remove('loading');
                signupBtn.disabled = false;
                return;
            }

            if (password.length < 6) {
                showError('Password must be at least 6 characters long');
                signupBtn.classList.remove('loading');
                signupBtn.disabled = false;
                return;
            }

            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    const user = userCredential.user;
                    return db.collection('users').doc(user.uid).set({
                        name: name,
                        restaurant: restaurant,
                        email: email,
                        role: 'owner',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    showSuccess('Sign-up successful! Logging you in...');
                    document.getElementById('signupModal').classList.remove('show');
                    signupBtn.classList.remove('loading');
                    signupBtn.disabled = false;
                    login(email, password);
                })
                .catch(error => {
                    showError('Sign-up failed: ' + error.message);
                    signupBtn.classList.remove('loading');
                    signupBtn.disabled = false;
                });
        }

        function togglePassword(inputId) {
            const passwordInput = document.getElementById(inputId);
            const toggleIcon = passwordInput.parentElement.querySelector('.toggle-password i');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = "none";
            }, 300);
        }

        function showSignUpModal() {
            document.getElementById('loginModal').classList.remove('show');
            document.getElementById('signupModal').classList.add('show');
        }

        function showLoginModal() {
            document.getElementById('signupModal').classList.remove('show');
            document.getElementById('loginModal').classList.add('show');
        }

        function filterOrdersByStatus(status) {
            const orderItems = document.querySelectorAll('.list-item');

            orderItems.forEach(item => {
                const statusPill = item.querySelector('.status-pill');
                if (!statusPill) return;

                const orderStatus = statusPill.textContent.toLowerCase();

                if (status === 'all' || orderStatus === status) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });

            const visibleOrders = document.querySelectorAll('.list-item[style="display: block"]');
            const ordersContainer = document.getElementById('ordersList');

            if (visibleOrders.length === 0 && orderItems.length > 0) {
                if (!document.querySelector('.no-orders-message')) {
                    const message = document.createElement('p');
                    message.className = 'no-orders-message';
                    message.textContent = 'No ' + status + ' orders found';
                    ordersContainer.appendChild(message);
                }
            } else {
                const message = document.querySelector('.no-orders-message');
                if (message) message.remove();
            }
        }

        function showSection(sectionId) {
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.style.display = 'none';
            });

            document.getElementById(sectionId).style.display = 'block';

            document.querySelectorAll('nav ul li a').forEach(link => {
                link.classList.remove('active');
            });

            document.querySelector(`nav ul li a[href="#${sectionId}"]`).classList.add('active');
        }
    </script>
</body>
</html>